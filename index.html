<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beli Robux - Chat Support</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(to bottom right, #101010, #282828);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    .box {
        background: rgba(255,255,255,0.05);
        border-radius: 12px;
        padding: 20px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }
    h1 {
        text-align: center;
        margin-top: 0;
    }
    input, textarea, button {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
    }
    input, textarea {
        background: rgba(255,255,255,0.1);
        color: white;
    }
    button {
        background: #00aaff;
        color: white;
        cursor: pointer;
        font-weight: bold;
    }
    button:hover {
        background: #0088cc;
    }
</style>
</head>
<body>
<div class="box">
    <h1>Chat Support</h1>
    <input id="nama" type="text" placeholder="Masukkan nama kamu">
    <textarea id="pesan" rows="3" placeholder="Tulis pesan kamu..."></textarea>
    <button onclick="kirimPesan()">Kirim Pesan</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, set } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

  // Konfigurasi Firebase (punyamu)
  const firebaseConfig = {
    apiKey: "AIzaSyAcFRkbZT3PD3BDObS-7T1769uH5Macvd0",
    authDomain: "reystore-support.firebaseapp.com",
    databaseURL: "https://reystore-support-default-rtdb.firebaseio.com",
    projectId: "reystore-support",
    storageBucket: "reystore-support.firebasestorage.app",
    messagingSenderId: "446513200960",
    appId: "1:446513200960:web:cbd40ca4315a8bf47044a5",
    measurementId: "G-YEBFKLREK5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let chatId = null;
  const messagesDiv = document.createElement("div");
  messagesDiv.style.height = "200px";
  messagesDiv.style.overflowY = "auto";
  messagesDiv.style.background = "rgba(255,255,255,0.1)";
  messagesDiv.style.marginTop = "15px";
  messagesDiv.style.padding = "10px";
  messagesDiv.style.borderRadius = "8px";
  document.querySelector(".box").insertBefore(messagesDiv, document.querySelector("button"));

  function scrollBottom() {
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function addMessage(sender, text) {
    const p = document.createElement("p");
    p.innerHTML = `<strong>${sender}:</strong> ${text}`;
    messagesDiv.appendChild(p);
    scrollBottom();
  }

  function kirimPesan() {
    const nama = document.getElementById('nama').value.trim();
    const pesan = document.getElementById('pesan').value.trim();
    if (!nama || !pesan) {
      alert('Nama dan pesan wajib diisi.');
      return;
    }

    if (!chatId) {
      // Buat chatId baru saat pertama kali user kirim pesan
      chatId = push(ref(db, "chats")).key;
      set(ref(db, "chats/" + chatId + "/username"), nama);

      // Dengarkan balasan admin
      onChildAdded(ref(db, "chats/" + chatId + "/messages"), (snap) => {
        const data = snap.val();
        addMessage(data.sender, data.text);
      });
    }

    // Kirim pesan user
    const msgRef = push(ref(db, "chats/" + chatId + "/messages"));
    set(msgRef, {
      sender: "user",
      text: pesan,
      time: Date.now()
    });

    document.getElementById('pesan').value = "";
  }

  window.kirimPesan = kirimPesan;
</script>
</body>
</html>
